{% assign contactID = request.params['id'] | escape %}
{% if contactID != null  %}
  {% fetchxml contactData%}
    <fetch top="1">
      <entity name="contact">
          <attribute name="emailaddress1" />
          <filter>
            <condition attribute="contactid" operator="eq" value="{{contactID}}" />
            <condition attribute="createdon" operator="on-or-before" value="{{ 'today' | date: 'yyyy-MM-dd HH:mm:ss' }}" />
          </filter>
      </entity>
    </fetch>
  {% endfetchxml%}
    {% assign emailaddress1 = "" %} 
    {% if contactData.results.entities.size > 0 %}
      {% assign emailaddress1 = contactData.results.entities[0].emailaddress1 %}
    {% endif %}
{
  "emailaddress1":"{{emailaddress1}}"
}
{% else %}
{% fetchxml notifications%}
  <fetch mapping="logical">
    <entity name="msdyn_globalvendorportalnotification">
        <attribute name="msdyn_name" />
        <attribute name="msdyn_description" />
        <attribute name="msdyn_globalvendorportalnotificationid" />
        <attribute name="statecode" />
        <attribute name="createdon" />
        <filter>
          <condition attribute="statecode" operator="eq" value="0"/>
          <condition attribute="createdon" operator="on-or-before" value="{{ 'today' | date: 'yyyy-MM-dd HH:mm:ss' }}" />
        </filter>
        <order attribute="createdon" descending="true"/>
    </entity>
  </fetch>
{% endfetchxml%}
[
{% for data in notifications.results.entities %}
  {
    "name": "{{ data.msdyn_name }}",
    "description": "{{ data.msdyn_description | replace: "\n", " "    }}",
    "globalvendor": "{{ data.msdyn_globalvendor }}",
    "globalvendorportalnotificationid": "{{ data.msdyn_globalvendorportalnotificationid }}",
    "createdon": "{{ data.createdon }}",
    "statecode": "{{ data.statecode.Value }}"
  }{% unless forloop.last %},{% endunless %}
{% endfor %}
]
{% endif %}