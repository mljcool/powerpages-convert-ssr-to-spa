<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
<body >
<div id="code-container">{% capture locale_json %}{% include 'Data.Languages' %}{% endcapture %}\r\n{% capture timezone_json %}{% include 'Data.Timezones' %}{% endcapture %}\r\n&lt;script id=\"locale-config\" type=\"application/json\"&gt;{{ locale_json | strip }}&lt;/script&gt;\r\n&lt;script id=\"timezone-config\" type=\"application/json\"&gt;{{ timezone_json | strip }}&lt;/script&gt;\r\n\r\n&lt;script&gt;\r\n  if (typeof msdyn === \"undefined\") msdyn = { __namespace: true };\r\n  if (typeof msdyn.Portal === \"undefined\") msdyn.Portal = { __namespace: true };\r\n  if (typeof msdyn.Portal.Snippets === \"undefined\") msdyn.Portal.Snippets = { __namespace: true };\r\n\r\n  (function () {\r\n    var rawLanguages = document.getElementById('locale-config')?.textContent || '{}';\r\n    var rawTimezones = document.getElementById('timezone-config')?.textContent || '{}';\r\n    var LOCALE_CONFIG;\r\n    var TIMEZONE_CONFIG;\r\n    try { \r\n        LOCALE_CONFIG = JSON.parse(rawLanguages);\r\n        TIMEZONE_CONFIG = JSON.parse(rawTimezones);\r\n    } catch (e) { \r\n        LOCALE_CONFIG = { languages: {} }; \r\n        TIMEZONE_CONFIG = { timezones: {} };\r\n    }\r\n\r\n    var userLcid = \"{{ user.mspp_userpreferredlcid.value | default: '1033' }}\";\r\n    var userTimezone = \"{{user.adx_timezone}}\";\r\n\r\n  var languageObj = (LOCALE_CONFIG.languages &amp;&amp; LOCALE_CONFIG.languages[String(userLcid)]) || null;\r\n    var timezoneObj = (TIMEZONE_CONFIG.timezones &amp;&amp; TIMEZONE_CONFIG.timezones[String(userTimezone)]) || null;\r\n\r\n    msdyn.Portal.Snippets = {\r\n      regWelModalTitle: \"{{ snippets['Registration/WelcomeModal/Title'] | strip_newlines | replace: '\\\"', '\\\\\\\"' }}\",\r\n      regThankModalContent: \"{{ snippets['Registration/ThankyouModal/Content'] | strip_newlines | replace: '\\\"', '\\\\\\\"' }}\",\r\n      headerVendorBidding: \"{{ snippets['Header/VendorBidding'] | strip_newlines | replace: '\\\"', '\\\\\\\"' }}\",\r\n      allInv: \"{{ snippets['Header/AllOpenInvoices'] | strip_newlines | replace: '\\\"', '\\\\\\\"' }}\",\r\n      draftInv: \"{{ snippets['Header/Draft'] | strip_newlines | replace: '\\\"', '\\\\\\\"' }}\",\r\n      submittedInv: \"{{ snippets['Header/Submitted'] | strip_newlines | replace: '\\\"', '\\\\\\\"' }}\",\r\n      approvedInv: \"{{ snippets['Header/Approved'] | strip_newlines | replace: '\\\"', '\\\\\\\"' }}\",\r\n      paidInv: \"{{ snippets['Header/Paid'] | strip_newlines | replace: '\\\"', '\\\\\\\"' }}\",\r\n      userLanguage: languageObj,\r\n      userTimezone: timezoneObj\r\n    };\r\n  })();\r\n&lt;/script&gt;\r\n</div>
</body>
</html>

<script>
	function encodeForJsString(input) {
		return input
			.replace(/</g, '&lt;')
			.replace(/>/g, '&gt;')
			.replace(/"/g, '\\"')
			.replace(/\r?\n/g, '\\r\\n');
	}

	function decodeFromJsString(input) {
		return input
			.replace(/\\r\\n/g, '\r\n')
			.replace(/\\"/g, '"')
			.replace(/&lt;/g, '<')
			.replace(/&gt;/g, '>');
	}

	// -------------------
	// Example usage:
	// -------------------
    const codeCointainer = document.getElementById('code-container').innerHTML;
	// console.log('codeCointainer:\n', codeCointainer);
	const raw = codeCointainer;
    const raw2 = ``
	const encoded = encodeForJsString(raw);
	console.log('Encoded:\n', encoded);

	const decoded = decodeFromJsString(raw);
	console.log('\nDecoded:\n', decoded);

</script>
